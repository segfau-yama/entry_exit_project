{% extends 'base.html' %}
{% load static %}

{% block title %}居場所わかる君{% endblock %}

{% block content %}
<div class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-4 py-4">
    {% for item in object_list %}
    <div class="col">
        <div class="card h-100">
            <div class="card-body">
                <div class="fs-3 card-title">{{ item.student }}</div>
                <div class="fs-5 card-subtitle">{{ item.get_location_display }}</div>
                {% if user == item.student %}
                <div class="d-grid gap-2 col-6 mx-auto">
                    <a href="{% url 'update' item.id %}" class="btn btn-primary">編集</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<p id="loc" class="position"></p>
<script>
    function successFunc( position ) {
        const x = position.coords.latitude;
        const y = position.coords.longitude;
        const msg = `緯度:${x}, 経度:${y}`;
        document.getElementById("loc").innerHTML = msg;

        console.log(x);
        console.log(y);
    }

    function errorFunc(error) {
        var errorMessage = {
            0: "原因不明のエラーが発生しました…。",
            1: "位置情報の取得が許可されませんでした…。",
            2: "電波状況などで位置情報が取得できませんでした…。",
            3: "位置情報の取得に時間がかかり過ぎてタイムアウトしました…。",
        } ;
        alert(errorMessage[error.code]);
    }

    var optionObj = {
        "enableHighAccuracy": false,
        "timeout": 8000,
        "maximumAge": 5000,
    } ;

    if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(successFunc, errorFunc, optionObj);
    }
    else {
        alert("あなたの端末では、現在位置を取得できません。");
    }
</script>
{% endblock %}
